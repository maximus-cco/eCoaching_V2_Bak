@model eCLAdmin.ViewModels.Reports.AdminActivitySearchViewModel

@Html.HiddenFor(m => m.PageSize)
<form class="form-inline" id="form-search-activity">
    <div class="form-group">
        <div class="input-group mydate">
            @Html.TextBoxFor(m =>m.StartDate, new { @class = "form-control required" })
            <span class="input-group-addon">
                <span class="glyphicon glyphicon-calendar"></span>
            </span>
        </div>
    </div>

    <div class="form-group">
        <div class="input-group mydate">
            @Html.TextBoxFor(m => m.EndDate, new { @class = "form-control required" })
            <span class="input-group-addon">
                <span class="glyphicon glyphicon-calendar"></span>
            </span>
        </div>
    </div>
 
    @Html.DropDownListFor(m => m.SelectedTypeId, Model.LogTypeSelectList, new { id = "select-type", @class = "form-control required" })
    @Html.DropDownListFor(m => m.SelectedAction, Model.ActionSelectList, new { id = "select-action", @class = "form-control required" })
    @Html.DropDownListFor(m => m.SelectedLog, Model.LogNameSelectList, new { id = "select-log", @class = "form-control required" })
    @Html.TextBoxFor(m => m.FreeTextSearch, new { id = "logname-empname", placeholder = "Log name, employee name ...", @class = "form-control"})

    <button type="button" class="btn btn-primary ml-1" id="btn-generate-report">Generate Report</button> 
</form>

<script src="@Url.Content("~/Scripts/eCLAdmin/dateTimePicker.js")"></script>

<script>

    $(document).ready(function () {
        $("#select-type").on("change", function () {
            $('#select-action').addClass('loadinggif')

            var logTypeSelected = $(this).val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetActions")',
                dataType: 'json',
                data: { logTypeId: logTypeSelected },

                success: function (actions) {
                    $('#select-action').empty();
                    $('#select-log').find('option').not(':first').remove();
                    var options = [];
                    $.each(actions, function (i, a) {
                        options.push('<option value="', a.Value, '">' + a.Text + '</option>');
                    });

                    $('#select-action').html(options.join(''));
                    $('#select-action').removeClass('loadinggif');
                }
            });
            return false;
        });

        $('#select-action').on('change', function () {
            $('#select-log').addClass('loadinggif')

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetLogNames")',
                dataType: 'json',
                data: {
                    logType: $('#select-type option:selected').text(),
                    action: $(this).val(),
                    startDate: $('#StartDate').val(),
                    endDate: $('#EndDate').val(),
                    logOrEmpName: $('#logname-empname').val()
                },

                success: function (logNames) {
                    $("#select-log").empty();
                    var options = [];
                    $.each(logNames, function (i, a) {
                        options.push('<option value="', a.Value, '">' + a.Text + '</option>');
                    });

                    $('#select-log').html(options.join(''));
                    $('#select-log').removeClass('loadinggif');
                }
            });
            return false;
        })

        $('#btn-generate-report').on('click', function (e) {
            e.preventDefault();

            //if (!validate()) {
            //    return;
            //}

            if (e.handled !== true) {
                e.handled = true;
                $(".please-wait").slideDown(500);
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GenerateReport")',
                    data: $('#form-search-activity').serialize(),
                    success: function (data) {
                        $('.required').css('border-color', '');
                        if (data.valid === false) {
                            $.each(data.validationErrors, function (key, value) {
                                $('[name="' + key + '"').css('border-color', 'red');
                            });
                            $('#div-report').html('');
                        } else {
                            $('.required').css('border-color', '');
                            $('#div-report').html(data);
                        }
                        /*$('#div-search-result').removeClass('hide');
                        $('#div-search-result').addClass('show');
                        $('#div-log-list').html(data);*/
                    }
                }).always(function () {
                       $(".please-wait").slideUp(500);
                   }) // end always
            } // end if e.handled
        });

        function validate() {
            var valid = true;
            var startDate = $('#input-start-date').val();
            var endDate = $('#input-end-date').val();
            var typeSelected = $('#select-type').val();
            var actionSelected = $('#select-action').val();
            var logSelected = $('#select-log').val();

            if (startDate == '') {
                $('#input-start-date').css('border-color', 'red');
                valid = false;
            }
            if (endDate == '') {
                $('#input-end-date').css('border-color', 'red');
                valid = false;
            }
            if (typeSelected == -2) {
                $('#select-type').css('border-color', 'red');
                valid = false;
            }
            if (actionSelected == 'Select Action') {
                $('#select-action').css('border-color', 'red');
                valid = false;
            }
            if (logSelected == 'Select Log') {
                $('#select-log').css('border-color', 'red');
                valid = false;
            }

            return valid;
        }

    });

</script>