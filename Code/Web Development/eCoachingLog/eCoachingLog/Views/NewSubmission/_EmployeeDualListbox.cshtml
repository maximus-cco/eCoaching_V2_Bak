@using eCoachingLog.Utils
@model eCoachingLog.ViewModels.NewSubmissionViewModel

<input type="hidden" id="WarningYesNo" />

<div class="row">
    <div class="col-sm-6">
        <a href="#" style="color: #337ab7" id="a-add-employee"><b>Add</b></a>
    </div>
    <div class="col-sm-6 hide" id="div-max-warning">
        <p class="text-danger" ><span class="glyphicon glyphicon-info-sign"></span>&nbsp;<b>The maximum number of employee in a Warning Submssion is @Constants.MAX_NUMBER_OF_EMPLOYEES_WARNING_PER_SUBMISSION.</b></p>
    </div>
    <div class="col-sm-6 hide" id="div-max-coaching">
        <p class="text-danger"><span class="glyphicon glyphicon-info-sign"></span>&nbsp;<b>The maximum number of employee in a coaching submission is @Constants.MAX_NUMBER_OF_EMPLOYEES_COACHING_PER_SUBMISSION.</b></p>
    </div>
</div>

<div id="div-employee-listbox" class="hide">
    <select multiple="multiple" size="10" name="duallistbox_employee" title="duallistbox_employee">
        @if (Model.EmployeeList != null) {
            foreach (var m in Model.EmployeeList) { 
                <option value="@m.Value" selected="@m.IsSelected">@m.Text</option>
            }
        }
    </select>
</div>

<script>
    var dlEmployee;
    $(function () {
        $("#bootstrap-duallistbox-selected-list_duallistbox_employeeaa").after("<div>test</div>");

        $('#div-employee-listbox').removeClass('hide');

        dlEmployee = $('select[name="duallistbox_employee"]').bootstrapDualListbox({
            nonSelectedListLabel: 'Not Selected ',
            selectedListLabel: 'Selected ',
            preserveSelectionOnMove: 'moved'
        });

        $("#bootstrap-duallistbox-selected-list_duallistbox_employee, #bootstrap-duallistbox-nonselected-list_duallistbox_employee").change(function () {
            handleEmployeeChange()
        });

        // todo: add '.removeall' click, hide page middle
        $(".removeall").click(function () {
            showHideMaxNumberEmployeeMessage();
            showHideNewSubmissionMiddle(false);
            $('#EmployeeIds').val('');
        });

        $(".moveall").click(function () {
            showHideMaxNumberEmployeeMessage();
            showHideNewSubmissionMiddle(true);
            $('#EmployeeIds').val($('[name="duallistbox_employee"]').val());
        });

        function handleEmployeeChange() {
            var selected = $('[name="duallistbox_employee"]').val();

            showHideMaxNumberEmployeeMessage();
            showHideNewSubmissionMiddle(selected.length > 0);
            $('#EmployeeIds').val(selected);
        }

        function showHideMaxNumberEmployeeMessage()
        {
            var selected = $('[name="duallistbox_employee"]').val();

            if ($('#WarningYesNo').val() === 'yes') {
                // check if max (1) reached for warning log
                if (selected.length > maxEmployeesWarningPerSubmission) { // 1
                    $('#div-max-warning').removeClass('hide');
                    $('#div-max-coaching').addClass('hide');
                } else {
                    $('#div-max-warning').addClass('hide');
                }
            } else {
                $('#div-max-warning').addClass('hide');
                // check if max (100) reached for coaching log
                if (selected.length > maxEmployeesCoachingPerSubmission) { // 100
                    $('#div-max-coaching').removeClass('hide');
                    $('#div-max-warning').addClass('hide');
                } else {
                    $('#div-max-coaching').addClass('hide');
                }
            }
        }

        function showHideNewSubmissionMiddle(show)
        {
            if (show === true) {
                $('#div-new-submission-middle').removeClass('hide');
                $('#div-new-submission-middle').addClass('show');
            } else {
                //$("#bootstrap-duallistbox-selected-list_duallistbox_employee").css('border-color', 'red');
                //resetIsCoachingByYou();
                //$('#div-new-submission-middle').removeClass('hide');
                //$('#div-new-submission-middle').addClass('show');
                //// Empty page bottom
                //$('#div-new-submission-bottom').empty();
            }
        }

    });

</script>
